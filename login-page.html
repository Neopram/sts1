<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STS Clearance Hub - Login</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .login-container {
            max-width: 1000px;
            width: 100%;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .login-header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .logo-icon {
            font-size: 28px;
        }
        
        .logo-text {
            font-size: 28px;
            font-weight: bold;
        }
        
        .login-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 10px;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 30px;
            text-align: center;
        }

        .dashboard-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin: 5px;
        }

        .badge-red {
            background: #ff6b6b;
            color: white;
        }

        .badge-teal {
            background: #4ecdc4;
            color: white;
        }

        .badge-mint {
            background: #95e1d3;
            color: #2c3e50;
        }

        .badge-green {
            background: #6ab04c;
            color: white;
        }
        
        .login-content {
            padding: 50px 30px;
        }
        
        .login-title {
            font-size: 28px;
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
            font-weight: 600;
        }
        
        .login-description {
            text-align: justify;
            color: #7f8c8d;
            margin-bottom: 40px;
            font-size: 15px;
            line-height: 1.6;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .user-card {
            background: white;
            border: 2px solid #ecf0f1;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 150px;
        }
        
        .user-card:hover {
            border-color: #3498db;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.2);
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 15px;
            color: white;
            font-weight: bold;
        }
        
        .user-role {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .user-email {
            font-size: 12px;
            color: #95a5a6;
            word-break: break-all;
        }
        
        .user-card.loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .user-card.loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            color: #e74c3c;
            text-align: center;
            padding: 15px;
            background: #fadbd8;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        
        .success-message {
            color: #27ae60;
            text-align: center;
            padding: 15px;
            background: #d5f4e6;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        @media (max-width: 768px) {
            .login-content {
                padding: 30px 20px;
            }
            
            .login-title {
                font-size: 22px;
            }
            
            .login-description {
                font-size: 14px;
            }
            
            .users-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <div class="logo">
                üö¢ STS Clearance Hub
            </div>
            <p style="opacity: 0.9;">Maritime Document Management System</p>
        </div>

        <div class="dashboard-header">
            <div class="dashboard-title">
                üîê SECURE LOGIN
            </div>
            <div>
                <span class="badge badge-red">üåç Global Access</span>
                <span class="badge badge-teal">üîí Encrypted</span>
                <span class="badge badge-mint">‚òÅÔ∏è Cloud Based</span>
                <span class="badge badge-green">‚úì SIRE 2.0 Ready</span>
            </div>
        </div>
        
        <div class="login-content">
            <h1 class="login-title">Select Your Role</h1>
            
            <p class="login-description">
                Welcome to the STS Clearance Hub - a comprehensive platform designed to streamline vessel compliance management. 
                Select your role below to access the dashboard tailored to your specific responsibilities. Each role provides 
                curated views and tools essential for efficient document and clearance management.
            </p>
            
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
            
            <div class="users-grid" id="usersGrid">
                <!-- Users will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8001/api/v1';
        const DEFAULT_PASSWORD = 'password123';

        // Hardcoded users as fallback
        const FALLBACK_USERS = [
            { email: 'admin@sts.com', role: 'Admin', avatar: 'üë®‚Äçüíº', color: '#667eea' },
            { email: 'broker@sts.com', role: 'Broker', avatar: 'üíº', color: '#f093fb' },
            { email: 'owner@sts.com', role: 'Owner', avatar: 'üëë', color: '#4facfe' },
            { email: 'seller@sts.com', role: 'Seller', avatar: 'üì¶', color: '#43e97b' },
            { email: 'buyer@sts.com', role: 'Buyer', avatar: 'üõí', color: '#fa709a' },
            { email: 'charterer@sts.com', role: 'Charterer', avatar: '‚õµ', color: '#30cfd0' },
            { email: 'viewer@sts.com', role: 'Viewer', avatar: 'üëÅÔ∏è', color: '#ffa502' }
        ];

        async function loadUsers() {
            const grid = document.getElementById('usersGrid');
            
            try {
                const response = await fetch(`${API_URL}/users/available/list`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) throw new Error('Failed to fetch users');
                
                const users = await response.json();
                displayUsers(Array.isArray(users) ? users : FALLBACK_USERS);
            } catch (error) {
                console.log('Using fallback users:', error.message);
                displayUsers(FALLBACK_USERS);
            }
        }

        function displayUsers(users) {
            const grid = document.getElementById('usersGrid');
            grid.innerHTML = '';
            
            users.forEach(user => {
                const card = document.createElement('div');
                card.className = 'user-card';
                
                const avatarColor = user.color || '#667eea';
                const avatar = user.avatar || 'üë§';
                
                card.innerHTML = `
                    <div class="user-avatar" style="background: ${avatarColor};">${avatar}</div>
                    <div class="user-role">${user.role || 'User'}</div>
                    <div class="user-email">${user.email}</div>
                `;
                
                card.addEventListener('click', () => login(user));
                grid.appendChild(card);
            });
        }

        async function login(user) {
            const card = event.target.closest('.user-card');
            card.classList.add('loading');
            
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: user.email,
                        password: DEFAULT_PASSWORD
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Login failed');
                }
                
                const data = await response.json();
                
                // Store token and user info
                localStorage.setItem('token', data.token || data.access_token);
                localStorage.setItem('user', JSON.stringify(user));
                
                successDiv.textContent = `Welcome, ${user.role}! Redirecting...`;
                successDiv.style.display = 'block';
                
                // Redirect to dashboard
                setTimeout(() => {
                    window.location.href = '/dashboard';
                }, 500);
                
            } catch (error) {
                console.error('Login error:', error);
                card.classList.remove('loading');
                errorDiv.textContent = `Login failed for ${user.email}. Please try again.`;
                errorDiv.style.display = 'block';
            }
        }

        // Load users on page load
        document.addEventListener('DOMContentLoaded', loadUsers);
    </script>
</body>
</html>